name: Keep Render App Alive

on:
  schedule:
    # Run every 10 minutes to prevent Render free tier from sleeping
    # GitHub Actions cron can have delays, so 10 min gives buffer before 15 min sleep
    - cron: '*/10 * * * *'
  
  workflow_dispatch: # Allow manual trigger from Actions tab

jobs:
  ping-app:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Render App
        run: |
          RENDER_URL="https://expanses-tracker.onrender.com"
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸš€ Keep-Alive Ping Started"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "Time: $(date '+%Y-%m-%d %H:%M:%S UTC')"
          echo "App URL: ${RENDER_URL}"
          echo ""
          
          # Ping the health endpoint
          HTTP_CODE=$(curl -s -o /dev/null -w "%{http_code}" "${RENDER_URL}/status")
          
          if [ "$HTTP_CODE" = "200" ]; then
            echo "âœ… Successfully pinged app!"
            echo "Status: HTTP $HTTP_CODE - App is awake and responsive"
          else
            echo "âš ï¸  Warning: App returned HTTP $HTTP_CODE"
            echo "Status: App might be waking up from sleep or endpoint issue"
          fi
          
          echo ""
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… Keep-Alive Ping Complete"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

      - name: Measure Response Time
        run: |
          RENDER_URL="https://expanses-tracker.onrender.com/"
          
          echo ""
          echo "â±ï¸  Measuring response time..."
          START=$(date +%s%N)
          curl -s "${RENDER_URL}/status" > /dev/null || true
          END=$(date +%s%N)
          DURATION=$(( (END - START) / 1000000 ))
          echo "Response time: ${DURATION}ms"
          echo ""
          echo "Note: Cold starts typically take 30-60 seconds (30000-60000ms)"
          echo "Warm responses should be under 1 second (1000ms)"
